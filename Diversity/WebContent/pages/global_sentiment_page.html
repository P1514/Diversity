<!DOCTYPE html>
<html lang="en">
<head>
  <title>Global Sentiment</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <!-- script responsável por desenhar os gráficos Google Charts -->
  <script type="text/javascript">
  var ws = new WebSocket('ws://127.0.0.1:8080/Diversity/server');
  var jsonData;
  
	ws.onopen = function () {
		var json = {
                "op":"globalsentiment",
				"param":null,
				"n_values":0,
				"value":null,
                }
                ws.send(JSON.stringify(json));
            };
			
    ws.onmessage = function (event) {
				jsonData = JSON.parse(event.data);
				drawGlobal();
            };
	
  
  google.charts.load('current', {packages: ['corechart', 'bar']});
  google.charts.setOnLoadCallback(checkValue);

	//gráfico sentimento global
    function drawGlobal() {


	
      var data = new google.visualization.DataTable();
	data.addColumn('string', 'Month');
	data.addColumn('number', 'Global');	  
	  				
				for (var i = 0; i < jsonData.length; i++) {
					var counter = jsonData[i];
					console.log(counter.month + " " + counter.sentiment);
					data.addRows([[counter.month, counter.sentiment]]);
				}

      var options = {
        title: 'Average Global Sentiment Over Time',
		colors : [ '#000000' ],
		hAxis: {
			title: 'Month'
		},
        vAxis: {
          title: 'Sentiment',
		  viewWindow : {
					max : 0,
					min : 100
				}
        },
		width: '100%',
		height: '100%'
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

      chart.draw(data, options);
    }

	//gráfico 1 (Sentimento ao longo do tempo segundo o género)
    function drawBasic() {

      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Month');
      data.addColumn('number', 'Male');
      data.addColumn('number', 'Female');
	  data.addColumn('number', 'Global');


	  //dados dummy (dados reais a serem posteriormente adicionados)
      data.addRows([
        ['January', 10, 5, 20],
		['February', 25, 15, 35],
		['March', 30, 20, 40],
		['April', 45, 35, 55],
		['May', 50, 40, 60],
		['June', 65, 55, 75],
		['July', 70, 60, 80],
		['August', 85, 75, 95],
		['September', 100, 90, 100]
      ]);

      var options = {
		title: 'Average Sentiment Over Time By Gender',
        hAxis: {
          title: 'Month'
        },
        vAxis: {
          title: 'Sentiment'
        },
		colors: ['#00617F', '#0093C8', '#000000'],
		width: '100%',
		height: '100%'
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
	
	//gráfico 2 (Sentimento ao longo do tempo segundo a localização)
	function drawBasic2() {

      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Month');
      data.addColumn('number', 'East');
      data.addColumn('number', 'West');
	  data.addColumn('number', 'Global');

	  //dados dummy (dados reais a serem posteriormente adicionados)
      data.addRows([
        ['January', 2, 8, 20],
		['February', 10, 16, 35],
		['March', 18, 24, 40],
		['April', 26, 31, 55],
		['May', 34, 39, 60],
		['June', 42, 47, 75],
		['July', 50, 55, 80],
		['August', 58, 63, 95],
		['September', 66, 71, 100]
      ]);

      var options = {
		title: 'Average Sentiment Over Time By Location',
        hAxis: {
          title: 'Month'
        },
        vAxis: {
          title: 'Sentiment'
        },
		colors: ['#FA1414', '#A60202', '#000000'],
		width: '100%',
		height: '100%'
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
	
	//gráfico 2 (Sentimento ao longo do tempo segundo faixas etárias)
	function drawBasic3(){
	
	  var data = new google.visualization.DataTable();
      data.addColumn('string', 'Month');
      data.addColumn('number', '0-30');
      data.addColumn('number', '31-60');
	  data.addColumn('number', '61+');
	  data.addColumn('number', 'Global');

	  //dados dummy (dados reais a serem posteriormente adicionados)
      data.addRows([
        ['January', 2, 8, 10, 20],
		['February', 10, 16, 18, 35],
		['March', 18, 24, 26, 40],
		['April', 26, 31, 33, 55],
		['May', 34, 39, 42, 60],
		['June', 42, 47, 49, 75],
		['July', 50, 55, 57, 80],
		['August', 58, 63, 65, 95],
		['September', 66, 71, 73, 100]
      ]);

      var options = {
		title: 'Average Sentiment Over Time By Age Range',
        hAxis: {
          title: 'Month'
        },
        vAxis: {
          title: 'Sentiment'
        },
		colors: ['#BFD730', '#8CA122', '#5C6E0E', '#000000'],
		width: '100%',
		height: '100%'
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
		
	
	}
	
	//desenha o gráfico consoante a opção escolhida nos radio buttons
	function checkValue(){
        switch(document.test.field.value){
		
            case "global":
             
				drawGlobal();
				break;

            case "gender":

				drawBasic();
				break;

            case "location":

				drawBasic2();
				break;

			case "age":

				drawBasic3();
				break;
        }
	}
</script>


<style>
#global{
	width: 88.5%;
	max-width: 900px;
	height: 88.5%;
	max-height: 1800px;
	padding-left: 0.75%;
	padding-right: 0.75%;
	margin: auto;
	clear: none;
	float: none;
	margin-left: auto;
}

input[type=radio] {
	margin-top: 5%;
    margin-left: 5%;
}

#chart_div{
	width: 100%;
	padding-left: 0.75%;
	padding-right: 0.75%;
	margin: auto;
	clear: none;
	float: none;
	margin-left: auto;
	margin-top: 5%;
}
</style>
</head>

<body>
<!-- Logotipo Diversity-->
<center>
	<a href="sentiment_home_page.html">
		<img src="images\Diversity-Logo-120x62.png" alt="Diversity Logo" align="top">
	</a>

<!-- Gráficos -->
<div id="global" class = "container">
	<h2 align="left">Global Sentiment</h2>
	
	<form align="left" name='test'>
		<input type="radio" name="field" value="global" onChange="checkValue()" checked>Global 
		<input type="radio" name="field" value="gender" onChange="checkValue()">Gender 
		<input type="radio" name="field" value="location" onChange="checkValue()">Location
		<input type="radio" name="field" value="age" onChange="checkValue()">Age Range		
	</form>
		
	<div id='chart_div'></div>
	
</div>
</center>      
</body>