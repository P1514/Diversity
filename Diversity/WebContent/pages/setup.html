
<!DOCTYPE html>

<html lang="en">
<head>

<meta http-equiv="Cache-Control"
	content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Chart Configuration</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>
<script>
	var json;
	var i = 0;
	function getCookie(name) {
		var value = "; " + document.cookie;
		var parts = value.split("; " + name + "=");
		if (parts.length == 2)
			return parts.pop().split(";").shift();
	}
	if (getCookie("developer") != "Guilherme")
		window.location.href = "http://localhost:20000/Diversity/pages/index.html";

	function setCookie() {
		document.cookie = "Product=" + $("#Products :selected").text();
		document.cookie = "PSS=" + document.getElementById("Products").value;
	}
	ws = new WebSocket('ws://' + window.location.hostname + ":"
			+ window.location.port + '/Diversity/server');

	ws.onopen = function() {
		var jsonData = {
			"Op" : "getconfig",
		}
		ws.send(JSON.stringify(jsonData));
	}
	ws.onmessage = function(event) {
		json = JSON.parse(event.data);
		console.log(json);

		if (json.Op == "Error") {
			alert(json.Message);
			return;
		}
		if (json[0].Op == "Configs") {
			setConfig();
		}

	}
	function send_config() {
		var jsonData = {
			"Op" : "setconfig",
			"Gen1" : document.getElementById("gender1").value,
			"Gen2" : document.getElementById("gender2").value,
			"Age1" : document.getElementById("firstage1").value + "-"
					+ document.getElementById("firstage2").value,
			"Age2" : document.getElementById("secondage1").value + "-"
					+ document.getElementById("secondage2").value,
			"Age3" : document.getElementById("thirdage1").value + "-"
					+ document.getElementById("thirdage2").value,
			"Loc1" : document.getElementById("location1").value,
			"Loc2" : document.getElementById("location2").value,
		}

		console.log(jsonData);

	}
	function setConfig() {
		var i=1;
		$('#age tbody').empty();
		$('#gender tbody').empty();
		$('#location tbody').empty();
		
			var tsize = json[i].Size;
			i++;
			for (var ii = 1; ii < 1+tsize; i++, ii++) {
				tr = $('<tr/>');
				tr
						.append("<tr><td>Range "
								+ ii
								+ "</td><td><input type=\"number\" id=\""
								+ ii
								+ "age1\" value=\""
								+ json[i].Min
								+ "\" onKeyUp=\"checknumber(this);\">"
								+ " - <input type=\"number\"id=\""
								+ ii
								+ "age2\" value=\""
								+ json[i].Max
								+ "\" onKeyUp=\"checknumber(this);\">"
								+ " <span class=\"glyphicon glyphicon-remove\"></span></td></tr>");
				$('#age tbody').append(tr);
			}
			tr = $('<tr/>');
			tr
					.append("<td><span class=\"glyphicon glyphicon-plus\"></span></td>");
			$('#age tbody').append(tr);
			var tsize = json[i].Size;
			i++;
			for (var ii = 1; ii < 1+tsize; i++, ii++) {
				tr = $('<tr/>');
				tr
						.append("<tr><td>Gender "
								+ ii
								+ "</td><td><input type=\"text\" id=\""
								+ ii
								+ "gender\" value=\""
								+ json[i].Gender
								+ "\"> <span class=\"glyphicon glyphicon-remove\"></span></td></tr>");
				$('#gender tbody').append(tr);
			}
			tr = $('<tr/>');
			tr
					.append("<td><span class=\"glyphicon glyphicon-plus\"></span></td>");
			$('#gender	 tbody').append(tr);
			var tsize = json[i].Size;
			i++;
			for (var ii = 1; ii < 1+tsize; i++, ii++) {
				tr = $('<tr/>');
				tr
						.append("<tr><td>Location "
								+ ii
								+ "</td><td><input type=\"text\" id=\""
								+ ii
								+ "gender\" value=\""
								+ json[i].Location
								+ "\"> <span class=\"glyphicon glyphicon-remove\"></span></td></tr>");
				$('#location tbody').append(tr);
			}
			tr = $('<tr/>');
			tr
					.append("<td><span class=\"glyphicon glyphicon-plus\"></span></td>");
			$('#location tbody').append(tr);
	}
	function checknumber(field) {
		field.value = field.value.replace(/[^0-9]/g, '');
		if (field.value > 99) {
			field.value = '99';
		} else if (field.value < 0) {
			field.value = '0';
		}

	}
</script>
<style>
input[type="number"] {
	width: 50px;
}

#tables {
	position: relative;
	width: 80%;
	margin-left: 10%;
	height: 50vh;
}

.inlineTable {
	display: inline-block;
	vertical-align: top
}

#setup {
	position: absolute;
	bottom: 0;
}
</style>
</head>
<body>

	<center>
		<img src="../images/Diversity-Logo-120x62.png" alt="Diversity Logo"
			align="top">
	</center>
	<!-- BotÃµes opcionais -->
	<div id="tables" align="center">
		<table id="age" class="inlineTable">
			<thead>
				<tr>
					<th>Age</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<table id="gender" class="inlineTable">
			<thead>
				<tr>
					<th>Gender</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<table id="location" class="inlineTable">
			<thead>
				<tr>
					<th>Location</th>
				</tr>
			</thead>
			<tbody></tbody>

		</table>

		<input id="setup" class="btn btn-default btn-block"
			onclick="send_config();" type="submit" value="Set up" />
	</div>

</body>